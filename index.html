<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="css/main.css" />
    <title>Express Chat</title>
  </head>
  <body>
      <ul id="messages"></ul>
        <form action="" class="form-chat">
          <div class="columns">
            <div class="column is-2">
              <input class="input is-medium" id="nick" placeholder="Nick"/>
            </div>
            <div class="column is-9">
              <input class="input is-medium" id="message" autocomplete="off" placeholder="Wiadomość" />
            </div>
            <div class="column">
              <button class="button is-success is-medium">
                <span class="icon is-small">
                  <i class="fas fa-arrow-circle-up"></i>
                </span>
                <span>Wyślij</span>
              </button>
            </div>
          </div>
        </form>

    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <script>
      $(function () {
        var socket = io();
        let defaultNick; 
        $('form').submit(function(){
          if($('#message').val() === '') {
            window.alert(`Musisz podać wiadomość!`);
            return false;
          }
          $('#nick').val() === '' ? defaultNick = 'Anonim': defaultNick = $('#nick').val();

          const messageWithNick = `${defaultNick}: ${$('#message').val()}`;
          socket.emit('chat message', messageWithNick);
          $('#message').val('');
          return false;
        });
        socket.on('chat message', function(msg, type){
          switch(type) {
            case 'join': {
              $('#messages').append($('<li class="join-text">').text(msg));
              break;
            }

            case 'leave': {
              $('#messages').append($('<li class="leave-text">').text(msg));
              break;
            }

            default: {
              $('#messages').append($('<li>').text(msg));
              break;
            }
          }
          window.scrollTo(0, document.body.scrollHeight);
        });
      });
    </script>
  </body>
</html>