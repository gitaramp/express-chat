<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="css/main.css" />
    <title>Express Chat</title>
  </head>
  <body>
    <ul id="messages"></ul>

    <div class="modal is-active">
      <div class="modal-background"></div>
      <div class="modal-content">
        <p class="is-size-2 has-text-primary">Witaj nowy!</p>
        <label class="label has-text-link">Twój nick</label>
        <form action="" class="form-login">
            <div class='columns'>
              <div class='column'>
                <div class="control">
                  <input class="input" id="nickName" type="text" placeholder="Nick">
                </div>
              </div>
              <div class='column'>
                <button class="button is-link">
                  <span class="icon is-small">
                    <i class="fas fa-sign-in-alt"></i>
                  </span>
                  <span>Dołącz do chatu</span>
                </button>
              </div>
            </div>
        </form>
      </div>
    </div>  

    <form action="" class="form-chat">
      <div class="columns">
        <div class="column is-11">
          <input class="input is-medium" id="message" autocomplete="off" placeholder="Wiadomość" />
        </div>
        <div class="column">
          <button class="button is-success is-medium">
            <span class="icon is-small">
              <i class="fas fa-arrow-circle-up"></i>
            </span>
            <span>Wyślij</span>
          </button>
        </div>
      </div>
    </form>

    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <script>
      $(function () {
        var socket = io();
        let nickName; 
        $('.form-login').submit(function(){
          nickName = $('#nickName').val();
          $('.modal').removeClass('is-active');
          return false;
        });

        $('.form-chat').submit(function(){
          if($('#message').val() === '') {
            window.alert(`Musisz podać wiadomość!`);
            return false;
          }
          nickName === '' ? nickName = 'Anonim': nickName;

          const messageWithNick = `${nickName}: ${$('#message').val()}`;
          socket.emit('chat message', messageWithNick);
          $('#message').val('');
          return false;
        });
        socket.on('chat message', function(msg, type){
          switch(type) {
            case 'join': {
              $('#messages').append($('<li class="join-text">').text(msg));
              break;
            }

            case 'leave': {
              $('#messages').append($('<li class="leave-text">').text(msg));
              break;
            }

            default: {
              $('#messages').append($('<li>').text(msg));
              break;
            }
          }
          window.scrollTo(0, document.body.scrollHeight);
        });
      });
    </script>
  </body>
</html>